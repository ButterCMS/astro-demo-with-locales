---
import BlogHeader from "../../../components/BlogHeader.astro";
import MySiteLayout from "../../../layouts/MySiteLayout.astro";
import SEO from "../../SEOs.astro";
import { butterCMS } from "../../../utils/buttercmssdk";
import BlogPost from "../../../components/BlogPost.astro";
import NotFoundSection from "../../../components/NotFoundSection";

const { pathname } = Astro.url;
const urlQuery = pathname.split("/")[3];

const availableData = await butterCMS.post
  .list({ category_slug: urlQuery })
  .then((r) => {
    return r.data.data;
  })
  .catch((err) => {
    return console.log(err);
  });

const entityName = await butterCMS.category
  .retrieve(urlQuery)
  .then((r) => {
    return r.data.data.name;
  })
  .catch((err) => {
    return console.log(err);
  });

const isDataAvailable = availableData == null || availableData.length > 0;
---

{
  isDataAvailable ? (
    <>
      <SEO
        title={`Sample Blog - category: ${entityName}`}
        description={`Sample blog powered by ButterCMS, showing category: ${entityName}`}
      />

      <MySiteLayout>
        <BlogHeader
          text={`Category: ${entityName}`}
          title="Blog Posts by Category"
          isVisible="true"
        />
        <BlogPost data={availableData} />
      </MySiteLayout>
    </>
  ) : (
    <NotFoundSection client:load />
  )
}
